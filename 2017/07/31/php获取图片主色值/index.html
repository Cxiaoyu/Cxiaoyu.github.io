<head>
    <meta charset="UTF-8">
    <title>php获取图片主色值</title>
    <link rel="stylesheet" href="../../../../css/myself.css">
    <link rel="shortcut icon" type="image/x-icon" href="element.ico" />
</head>
<body>
<div class="cover">
    <div class="ll"></div>
    <div class="title"><img src="http://cxiaoyu.oss-cn-shanghai.aliyuncs.com/element.ico?Expires=1503030739&OSSAccessKeyId=TMP.AQFHkqvSODQHfdXMvBLieMOBxleMtSudMYIWjb92lvWoIR6e1UAoiHxQbs7HADAtAhUAj-As93lEV2L1zY376LPHqC8ZA8cCFBOWeeZL3BbCvVOUKe-BJ91ilS92&Signature=bPU2yTQkFlZhfnUntBwvqZjxSdg%3D" alt="" id="title_img"> Lady Chen's Home
        Page
    </div>
    <div class="line_1"></div>
    <div class="line_2"></div>
    <div class="line_3"></div>
    <nav class="nav">
        <ul>
            <li><a href='../../../../index.html'>Home</a></li>
            <li><a href='../../../../work'>Work</a></li>
            <li><a href='../../../../enjoy'>Enjoy</a></li>
            <li><a href='../../../../contact'>About</a></li>
        </ul>
    </nav>
    <div class="page_border">
        <div class="page_title">
            php获取图片主色值
        </div>
        <div class="page_content">
            <p>PHP获取图片主色值的方法，虽然网上大把的代码，但是还是想要自己保存一份。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> *图片主要（三通道）颜色判断</div><div class="line"> *author cuitengwei</div><div class="line"> *2014/1/16</div><div class="line"> */</div><div class="line">private <span class="keyword">function</span> imgColor(<span class="variable">$imgUrl</span>)</div><div class="line">&#123;</div><div class="line">    <span class="variable">$imageInfo</span> = getimagesize(<span class="variable">$imgUrl</span>);</div><div class="line">    //图片类型</div><div class="line">    <span class="variable">$imgType</span> = strtolower(substr(image_type_to_extension(<span class="variable">$imageInfo</span>[2]), 1));</div><div class="line">    //对应函数</div><div class="line">    <span class="variable">$imageFun</span> = <span class="string">'imagecreatefrom'</span> . (<span class="variable">$imgType</span> == <span class="string">'jpg'</span> ? <span class="string">'jpeg'</span> : <span class="variable">$imgType</span>);</div><div class="line">    <span class="variable">$i</span> = <span class="variable">$imageFun</span>(<span class="variable">$imgUrl</span>);</div><div class="line">    //循环色值</div><div class="line">    <span class="variable">$rColorNum</span> = <span class="variable">$gColorNum</span> = <span class="variable">$bColorNum</span> = <span class="variable">$total</span> = 0;</div><div class="line">    <span class="keyword">for</span> (<span class="variable">$x</span> = 0; <span class="variable">$x</span> &lt; imagesx(<span class="variable">$i</span>); <span class="variable">$x</span>++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="variable">$y</span> = 0; <span class="variable">$y</span> &lt; imagesy(<span class="variable">$i</span>); <span class="variable">$y</span>++) &#123;</div><div class="line">            <span class="variable">$rgb</span> = imagecolorat(<span class="variable">$i</span>, <span class="variable">$x</span>, <span class="variable">$y</span>);</div><div class="line">            //三通道</div><div class="line">            <span class="variable">$r</span> = (<span class="variable">$rgb</span> &gt;&gt; 16) &amp; 0xFF;</div><div class="line">            <span class="variable">$g</span> = (<span class="variable">$rgb</span> &gt;&gt; 8) &amp; 0xFF;</div><div class="line">            <span class="variable">$b</span> = <span class="variable">$rgb</span> &amp; 0xFF;</div><div class="line">            <span class="variable">$rColorNum</span> += <span class="variable">$r</span>;</div><div class="line">            <span class="variable">$gColorNum</span> += <span class="variable">$g</span>;</div><div class="line">            <span class="variable">$bColorNum</span> += <span class="variable">$b</span>;</div><div class="line">            <span class="variable">$total</span>++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="variable">$rgb</span> = array();</div><div class="line">    <span class="variable">$rgb</span>[<span class="string">'r'</span>] = round(<span class="variable">$rColorNum</span> / <span class="variable">$total</span>);</div><div class="line">    <span class="variable">$rgb</span>[<span class="string">'g'</span>] = round(<span class="variable">$gColorNum</span> / <span class="variable">$total</span>);</div><div class="line">    <span class="variable">$rgb</span>[<span class="string">'b'</span>] = round(<span class="variable">$bColorNum</span> / <span class="variable">$total</span>);</div><div class="line">    <span class="built_in">return</span> round(<span class="variable">$rColorNum</span> / <span class="variable">$total</span>) . <span class="string">','</span> . round(<span class="variable">$gColorNum</span> / <span class="variable">$total</span>) . <span class="string">','</span> . round(<span class="variable">$bColorNum</span> / <span class="variable">$total</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> *RGB TO HEX</div><div class="line"> *author cuitengwei</div><div class="line"> *2014/1/16</div><div class="line"> */</div><div class="line">private <span class="keyword">function</span> rgb2html(<span class="variable">$r</span>, <span class="variable">$g</span> = -1, <span class="variable">$b</span> = -1)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (is_array(<span class="variable">$r</span>) &amp;&amp; sizeof(<span class="variable">$r</span>) == 3)</div><div class="line">        list(<span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>) = <span class="variable">$r</span>;</div><div class="line">    <span class="variable">$r</span> = intval(<span class="variable">$r</span>);</div><div class="line">    <span class="variable">$g</span> = intval(<span class="variable">$g</span>);</div><div class="line">    <span class="variable">$b</span> = intval(<span class="variable">$b</span>);</div><div class="line">    <span class="variable">$r</span> = dechex(<span class="variable">$r</span> &lt; 0 ? 0 : (<span class="variable">$r</span> &gt; 255 ? 255 : <span class="variable">$r</span>));</div><div class="line">    <span class="variable">$g</span> = dechex(<span class="variable">$g</span> &lt; 0 ? 0 : (<span class="variable">$g</span> &gt; 255 ? 255 : <span class="variable">$g</span>));</div><div class="line">    <span class="variable">$b</span> = dechex(<span class="variable">$b</span> &lt; 0 ? 0 : (<span class="variable">$b</span> &gt; 255 ? 255 : <span class="variable">$b</span>));</div><div class="line">    <span class="variable">$color</span> = (strlen(<span class="variable">$r</span>) &lt; 2 ? <span class="string">'0'</span> : <span class="string">''</span>) . <span class="variable">$r</span>;</div><div class="line">    <span class="variable">$color</span> .= (strlen(<span class="variable">$g</span>) &lt; 2 ? <span class="string">'0'</span> : <span class="string">''</span>) . <span class="variable">$g</span>;</div><div class="line">    <span class="variable">$color</span> .= (strlen(<span class="variable">$b</span>) &lt; 2 ? <span class="string">'0'</span> : <span class="string">''</span>) . <span class="variable">$b</span>;</div><div class="line">    <span class="built_in">return</span> <span class="string">'#'</span> . <span class="variable">$color</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> *HEX TO RGB</div><div class="line"> *author cuitengwei</div><div class="line"> *2014/1/16</div><div class="line"> */</div><div class="line">private <span class="keyword">function</span> html2rgb(<span class="variable">$color</span>)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="variable">$color</span>[0] == <span class="string">'#'</span>)</div><div class="line">        <span class="variable">$color</span> = substr(<span class="variable">$color</span>, 1);</div><div class="line">    <span class="keyword">if</span> (strlen(<span class="variable">$color</span>) == 6)</div><div class="line">        list(<span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>) = array(<span class="variable">$color</span>[0] . <span class="variable">$color</span>[1],</div><div class="line">            <span class="variable">$color</span>[2] . <span class="variable">$color</span>[3],</div><div class="line">            <span class="variable">$color</span>[4] . <span class="variable">$color</span>[5]);</div><div class="line">    elseif (strlen(<span class="variable">$color</span>) == 3)</div><div class="line">        list(<span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>) = array(<span class="variable">$color</span>[0] . <span class="variable">$color</span>[0], <span class="variable">$color</span>[1] . <span class="variable">$color</span>[1], <span class="variable">$color</span>[2] . <span class="variable">$color</span>[2]);</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">    <span class="variable">$r</span> = hexdec(<span class="variable">$r</span>);</div><div class="line">    <span class="variable">$g</span> = hexdec(<span class="variable">$g</span>);</div><div class="line">    <span class="variable">$b</span> = hexdec(<span class="variable">$b</span>);</div><div class="line">    <span class="built_in">return</span> array(<span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public <span class="keyword">function</span> <span class="function"><span class="title">test</span></span>()</div><div class="line">&#123;</div><div class="line">//        <span class="variable">$imgUrl</span> = CACHE_PATH . <span class="string">'12.png'</span>;//图片地址</div><div class="line">    <span class="variable">$imgUrl</span> = <span class="string">'http://qiniu.yishuvip.cn/thumbimg.e03ec6f8100f36c310485e767c76aa4f.bmp'</span>;//图片地址</div><div class="line">    var_dump(<span class="variable">$this</span>-&gt;imgColor(<span class="variable">$imgUrl</span>));</div><div class="line">    var_dump(<span class="variable">$this</span>-&gt;rgb2html(245, 255, 244));</div><div class="line">    var_dump(<span class="variable">$this</span>-&gt;html2rgb(<span class="string">'#F08098'</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>end！</p>

        </div>
    </div>
    <footer>
        <p>Don't be too quick to judge</p>
        <p>email:657466063@qq.com ; weibo:<span>勇敢无敌</span>Dangerous</p>
    </footer>
</div>

<script src="../../../../js/jquery.min.js"></script>
<script src="../../../../js/myself.js"></script>
</body>