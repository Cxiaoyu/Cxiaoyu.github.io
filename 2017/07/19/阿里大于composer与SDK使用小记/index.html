<head>
    <meta charset="UTF-8">
    <title>阿里大于composer与SDK使用小记</title>
    <link rel="stylesheet" href="../../../../css/myself.css">
    <link rel="shortcut icon" type="image/x-icon" href="element.ico" />
</head>
<body>
<div class="cover">
    <div class="ll"></div>
    <div class="title"><img src="http://cxiaoyu.oss-cn-shanghai.aliyuncs.com/element.ico?Expires=1503030739&OSSAccessKeyId=TMP.AQFHkqvSODQHfdXMvBLieMOBxleMtSudMYIWjb92lvWoIR6e1UAoiHxQbs7HADAtAhUAj-As93lEV2L1zY376LPHqC8ZA8cCFBOWeeZL3BbCvVOUKe-BJ91ilS92&Signature=bPU2yTQkFlZhfnUntBwvqZjxSdg%3D" alt="" id="title_img"> Lady Chen's Home
        Page
    </div>
    <div class="line_1"></div>
    <div class="line_2"></div>
    <div class="line_3"></div>
    <nav class="nav">
        <ul>
            <li><a href='../../../../index.html'>Home</a></li>
            <li><a href='../../../../work'>Work</a></li>
            <li><a href='../../../../enjoy'>Enjoy</a></li>
            <li><a href='../../../../contact'>About</a></li>
        </ul>
    </nav>
    <div class="page_border">
        <div class="page_title">
            阿里大于composer与SDK使用小记
        </div>
        <div class="page_content">
            <p>在之前的项目中使用阿里大于发送短信用的是下载SDK方式，代码如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">//<span class="variable">$SignName</span>:短信模板签名，<span class="variable">$Param</span>:短信内容参数，所有参数均为字符串</div><div class="line">//<span class="variable">$phone</span>:目标手机号，<span class="variable">$temp</span>:短信模板号</div><div class="line">//引用sdk方式根据自身情况而定，以下是ci引用方式</div><div class="line">protected <span class="keyword">function</span> BaseDayu(<span class="variable">$SignName</span>, <span class="variable">$Param</span>, <span class="variable">$phone</span>, <span class="variable">$temp</span>)</div><div class="line">&#123;</div><div class="line">    <span class="variable">$this</span>-&gt;load-&gt;library(<span class="string">'alidayu/top/TopClient'</span>);</div><div class="line">    <span class="variable">$this</span>-&gt;load-&gt;library(<span class="string">'alidayu/top/request/AlibabaAliqinFcSmsNumSendRequest'</span>);</div><div class="line">    <span class="variable">$c</span> = new \TopClient;</div><div class="line">    <span class="variable">$c</span>-&gt;appkey = SMS_DAYU_APP;</div><div class="line">    <span class="variable">$c</span>-&gt;secretKey = SMS_DAYU_KEY;</div><div class="line">    <span class="variable">$c</span>-&gt;format = <span class="string">'json'</span>;</div><div class="line">    <span class="variable">$c</span>-&gt;connectTimeout = 3;</div><div class="line">    <span class="variable">$c</span>-&gt;readTimeout = 3;</div><div class="line">    <span class="variable">$req</span> = new \AlibabaAliqinFcSmsNumSendRequest;</div><div class="line">    <span class="variable">$req</span>-&gt;setSmsType(<span class="string">"normal"</span>);</div><div class="line">    <span class="variable">$req</span>-&gt;setSmsFreeSignName(<span class="variable">$SignName</span>);</div><div class="line">    <span class="variable">$req</span>-&gt;setSmsParam(json_encode(<span class="variable">$Param</span>));</div><div class="line">    <span class="variable">$req</span>-&gt;setRecNum(<span class="variable">$phone</span>);</div><div class="line">    <span class="variable">$req</span>-&gt;setSmsTemplateCode(<span class="variable">$temp</span>);</div><div class="line">    <span class="variable">$resp</span> = <span class="variable">$c</span>-&gt;execute(<span class="variable">$req</span>);</div><div class="line">    <span class="variable">$resp</span> = json_decode(json_encode(<span class="variable">$resp</span>), <span class="literal">true</span>);</div><div class="line">    <span class="keyword">if</span> (!isset(<span class="variable">$resp</span>[<span class="string">'result'</span>])) &#123;</div><div class="line">        <span class="variable">$resp</span>[<span class="string">'result'</span>] = array();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (!isset(<span class="variable">$resp</span>[<span class="string">'result'</span>][<span class="string">'err_code'</span>])) &#123;</div><div class="line">        <span class="variable">$resp</span>[<span class="string">'result'</span>][<span class="string">'err_code'</span>] = <span class="string">''</span>;</div><div class="line">    &#125;</div><div class="line">     <span class="built_in">return</span> <span class="variable">$resp</span>[<span class="string">'result'</span>][<span class="string">'err_code'</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这次的项目使用的是thinkphp5，那么阿里大于的第三方库使用的是composer安装方式，安装下来发现跟之前的sdk文件目录差别有些大，<br>composer安装<img src="http://or2fnb3it.bkt.clouddn.com/com.png" alt="这是使用composer方式安装的文件目录">sdk下载<img src="http://or2fnb3it.bkt.clouddn.com/sdk.png" alt="这是下载sdk方式的文件目录"><br>composer方式安装的库通过readme直接就能看到发送短信示例，并且是tp5的示例，不贴示例，我自己的代码如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">use anerg\Alidayu\SmsGateWay;</div><div class="line"></div><div class="line">protected <span class="keyword">function</span> BaseDayu(<span class="variable">$phone</span>, <span class="variable">$Param</span>, <span class="variable">$temp</span>)</div><div class="line">&#123;</div><div class="line">    <span class="variable">$AliSMS</span> = new SmsGateWay();</div><div class="line">    <span class="variable">$rsp</span> = <span class="variable">$AliSMS</span>-&gt;send(<span class="variable">$phone</span>, <span class="variable">$Param</span>, <span class="variable">$temp</span>);</div><div class="line">    <span class="keyword">if</span> (isset(<span class="variable">$rsp</span>[<span class="string">'alibaba_aliqin_fc_sms_num_send_response'</span>][<span class="string">'result'</span>][<span class="string">'success'</span>]) &amp;&amp; <span class="variable">$rsp</span>[<span class="string">'alibaba_aliqin_fc_sms_num_send_response'</span>][<span class="string">'result'</span>][<span class="string">'success'</span>] == <span class="string">'true'</span>) &#123;</div><div class="line">        <span class="variable">$error_msg</span> = <span class="string">'发送成功'</span>;</div><div class="line">        <span class="built_in">return</span> array(<span class="string">'code'</span> =&gt; 1, <span class="string">'msg'</span> =&gt; <span class="variable">$error_msg</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        switch (<span class="variable">$rsp</span>[<span class="string">'error_response'</span>][<span class="string">'sub_code'</span>]) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">'isv.BUSINESS_LIMIT_CONTROL'</span>:</div><div class="line">                <span class="variable">$error_msg</span> = <span class="string">'请勿频繁请求,稍后再试'</span>;</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'isv.MOBILE_NUMBER_ILLEGAL'</span>:</div><div class="line">                <span class="variable">$error_msg</span> = <span class="string">'手机号码格式不正确'</span>;</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            default :</div><div class="line">                <span class="variable">$error_msg</span> = <span class="string">'短信系统异常'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">return</span> array(<span class="string">'code'</span> =&gt; 0, <span class="string">'msg'</span> =&gt; <span class="variable">$error_msg</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>那么这篇记录并只是代码的差异，而是备忘，我在官方文档中没有找到composer方式安装的库的说明文档，我补充一下：<br>要在配置文件中配置”app_key”,”signature”,”app_secret”,在SmsGateWay类里只能找到app_key和signature的配置读取，只有往深了找，发现在Sign类下的create方法里读取了app_secret，所以配置项有三项，不然短信发送失败，并且示例代码中”$rsp[‘error_response’][‘sub_code’]”是读取不到的，根本不会返回这个参数，直接报错。</p>

        </div>
    </div>
    <footer>
        <p>Don't be too quick to judge</p>
        <p>email:657466063@qq.com ; weibo:<span>勇敢无敌</span>Dangerous</p>
    </footer>
</div>

<script src="../../../../js/jquery.min.js"></script>
<script src="../../../../js/myself.js"></script>
</body>